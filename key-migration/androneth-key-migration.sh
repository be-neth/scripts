#!/system/bin/sh

##
# TODO:
# Get Testkey networkstack key in right format.
# Get Release networkstack key in right format.
##


# Androneth Release key - "Official"
platform_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1cp+d2HAWCpUnx+tLOVGYCtXIRmoE9jQwFsQTRkOp+SKbi8IXnUOBEkJmH3G+IJGfr2P2xtwBncVNDKcbbjpDr/X7q1NyfPfOHIN9bnW4UrJkbZROetef0l2+vIXvirmJpNtOGpNUFeqLTs7KAF1wQ5naTaFgBg3zkL6Udlsqxino+nKJthDzKvZOiLi0m/BqTNVPU+e9kVRWQEkAV+4IC4YeYynQJoz1Mgvc/tC8shdkXpJ6h48egwmPJd7ExlIU7A+fB65rJemPjTTpCv0R+aOFxDAxmTdT7Du/2p0m6B87nvhaeDjt8N4x+4hRT7sx7Hh0KvW0JlsStzVCH9PrQIDAQAB"
platform_cert_release="30820405308202eda003020102021406ae7f8e2372714347f97cbc9c5aab7aae86943a300d06092a864886f70d01010b0500308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d301e170d3231303230393136343033325a170d3438303632373136343033325a308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d30820122300d06092a864886f70d01010105000382010f003082010a0282010100d5ca7e7761c0582a549f1fad2ce546602b572119a813d8d0c05b104d190ea7e48a6e2f085e750e044909987dc6f882467ebd8fdb1b7006771534329c6db8e90ebfd7eead4dc9f3df38720df5b9d6e14ac991b65139eb5e7f4976faf217be2ae626936d386a4d5057aa2d3b3b280175c10e67693685801837ce42fa51d96cab18a7a3e9ca26d843ccabd93a22e2d26fc1a933553d4f9ef64551590124015fb8202e18798ca7409a33d4c82f73fb42f2c85d917a49ea1e3c7a0c263c977b13194853b03e7c1eb9ac97a63e34d3a42bf447e68e1710c0c664dd4fb0eeff6a749ba07cee7be169e0e3b7c378c7ee21453eecc7b1e1d0abd6d0996c4adcd5087f4fad0203010001a3533051301d0603551d0e041604148391c54c5042a8999af286c21241c9b8cb5b441d301f0603551d230418301680148391c54c5042a8999af286c21241c9b8cb5b441d300f0603551d130101ff040530030101ff300d06092a864886f70d01010b0500038201010094a4a7ec5d0ea2a8d110049d25ebd627aaedac0f76efa2d05d778a92339b9a7271fc7f3f7bb4192687379106778dfc12b96fd776200c5aa8d9263aacfda812b83fdd3f4bcf18eee1fa04e70c9234f5085f9c3f930182901e37a1a6bd8bb8d6fe9dfd32757a28e1f632f707bfe64d70b83d807b63695bdb53937d5122c4d3c6255b70876a82863aab51a769ccaa4c188306670a67a96afaf12a6f9744ff4d187a5a1c39d6206b6b644c599baa57eac6edd18280380a51b58aa8f5c1871eae8b2d5c5b79d70b7d6cda3aab5dcc5baaece556380202eeaf409d7984b80ad8a4c68f9f7169531356d75a6e498b7090dbc913a7f021909fa42a8e5350abc8b7078e66"
media_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvGGR3AL6q5zzXjjXlLExJbSrmWmrA3HE/Lh8wFKOxPnZaR8/PYdiAZT1E55E6xj/0noMEBZS5udHtW8yOxxLsyOCgFJ5n812kOT2q8aEtHuuPCo/ZDh43/iLMAvfm+kj9kU3Qva4/rKHPxzWOU5ZUMcSu/73/bfLV7mG7XqaqsN57FC6pkgTpUwSk7trguvE/f7QCSBhz8Br5uaQ9nQoVuhu9rzdn8UMtfct2Ma3Uc10sYSAMa3rdumBVPezc7zVg2djwRiXZbCOGnVtsFfKkkSY2pyc9nAfFKO9+FBP4u7bnIIn8ETUMqNW9r8px4CzI9AtZ81si8mr9mtAWLWaBwIDAQAB"
media_cert_release="30820405308202eda0030201020214343573f42a02db659524c1adbdca184b7c04e3e1300d06092a864886f70d01010b0500308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d301e170d3231303230393136343033345a170d3438303632373136343033345a308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d30820122300d06092a864886f70d01010105000382010f003082010a0282010100bc6191dc02faab9cf35e38d794b13125b4ab9969ab0371c4fcb87cc0528ec4f9d9691f3f3d87620194f5139e44eb18ffd27a0c101652e6e747b56f323b1c4bb323828052799fcd7690e4f6abc684b47bae3c2a3f643878dff88b300bdf9be923f6453742f6b8feb2873f1cd6394e5950c712bbfef7fdb7cb57b986ed7a9aaac379ec50baa64813a54c1293bb6b82ebc4fdfed0092061cfc06be6e690f6742856e86ef6bcdd9fc50cb5f72dd8c6b751cd74b1848031adeb76e98154f7b373bcd5836763c1189765b08e1a756db057ca924498da9c9cf6701f14a3bdf8504fe2eedb9c8227f044d432a356f6bf29c780b323d02d67cd6c8bc9abf66b4058b59a070203010001a3533051301d0603551d0e041604144ffd34d12b01a3b4ec7bfc25b126afc67bd409b1301f0603551d230418301680144ffd34d12b01a3b4ec7bfc25b126afc67bd409b1300f0603551d130101ff040530030101ff300d06092a864886f70d01010b0500038201010066e220cf61c8bd7a24e95b8ccf1c06afd883946ec646f809147565d10ce5e975992eae0e47688998616166c4396ebb141a8d3c897a2aecb2ab181cfb04d93dd1cc4dcdae3aa8367a6d8b3995a02c92e302332b822e8b57641eb15a0c0bb9efd4f8d81ea3e799463a16a470ed344177f7cd363c2276966205c04244c573fb6182150bff9807f958505c01de6860ae9895ce5658ad5f99814e33f132e4817a4cea166bd8bfcd33b52982f26c84c8d44ea92a8489d484cf854de01f40dd5d323283834ab229f79d6e7d80b6e88bdc11d911f77cc4bfd27c5a4f2643d249aaf5a4f8f9c53826e68e564ed5b30a355f9b937d4d7699458feeaeaac510c96402254b19"
shared_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxYmfXfVxvu7I6P/SCao4iodRdADL2opEs6Z1Yr5CWNhYyFq1ay7OYVrygGZU7o6mLP/9/oVxb0c0LPgn+OXraX6iO3mYbDFLaMLnNcUP7HCrYbQ5tWOZHFJmdaU6o8O18bFWfHmlxRBVNXtjTHsZGgErzov1z1dXWR86g8HuGOPGDuD8jL9PSoMUUoqeNzkWZ9u95eGH7OtN+c5SdOs7ggVX3/1uDejzSTNnfLrk004nW/3JC/xEPrG2FkrDCrREx0jDdEnIo5dHVHrSs1oaR2KSDzxDlS1YjFOts9uVjJaildfhTOl6dwt9uQO592cqSJGR5OAIrq5pbXVmwmos/QIDAQAB"
shared_cert_release="30820405308202eda00302010202146e818dad069bb48d6a8da3022c0fe8d00440d1c5300d06092a864886f70d01010b0500308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d301e170d3231303230393136343033335a170d3438303632373136343033335a308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d30820122300d06092a864886f70d01010105000382010f003082010a0282010100c5899f5df571beeec8e8ffd209aa388a87517400cbda8a44b3a67562be4258d858c85ab56b2ece615af2806654ee8ea62cfffdfe85716f47342cf827f8e5eb697ea23b79986c314b68c2e735c50fec70ab61b439b563991c526675a53aa3c3b5f1b1567c79a5c51055357b634c7b191a012bce8bf5cf5757591f3a83c1ee18e3c60ee0fc8cbf4f4a8314528a9e37391667dbbde5e187eceb4df9ce5274eb3b820557dffd6e0de8f34933677cbae4d34e275bfdc90bfc443eb1b6164ac30ab444c748c37449c8a39747547ad2b35a1a4762920f3c43952d588c53adb3db958c96a295d7e14ce97a770b7db903b9f7672a489191e4e008aeae696d7566c26a2cfd0203010001a3533051301d0603551d0e04160414bd0a3e7dac23dff46ac9731d729f016f1d11c66f301f0603551d23041830168014bd0a3e7dac23dff46ac9731d729f016f1d11c66f300f0603551d130101ff040530030101ff300d06092a864886f70d01010b050003820101007ef40a8a01c6df34353d1c0286bddd191c63686bd8651a5d6c3c9907a34b272c0a3d2a91baa8a1ecda36d5ae741e81bd51017fa7a07a8c496df0610fd649edd3b9851fc70dde3d7b0ec80ad96216f908f2b3b291c045a3e7090c753005e05c746b8c98a6205576ded1eeddc92ff9fb5e9a000a3e7bfab2aec9e48a6488cac26c263ae63ef198dc044427d501b6383418c5943645a5322b99155676064ded29914151a9b81c8244cba5c942aa42d8aff9b00a69eb258f64d15c1d32fe460a4cdeb819097b4b7243ab39b3cafbd34408f4ee60a82c9cfb9db74a4d1d7d71953824853083353dedd2db5fb737392a3e10b166c9464f0b495405ee6fc7b5d3052697"
release_key="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1vx/0piMtYarbCr9XYOvsIP20ktL1d6F/rETL+e44RrEvLtoQ1oR74B5EJa3FlfhyLqBP2h0RHesn/1LgH4nRXFqZpgRssL8Pudigqa5r+TtsINeS1vGEPQ+egXQZ2lFTzVabZ9txx6+yTObYUsgJWqvRGqH9WxYIOXZfzRnlm8vI1kRqZYANkEZVGQCvvLE3+ZrgLkmGR/S/Wdob1SgZ/CfgiQXNtNnSn6rzKS1D+nZmkPGzxx6FwF1mt1AZc8+ACGV7nJVWaQBH6SS/lH4B5VaUz2NQZfBt14pV2mmmnt6thmyVRbIiKaAtrye5W0kehyvcEceoaEHqkAbSJXd2wIDAQAB"
release_cert="30820405308202eda00302010202145a560ce1deb215ba2df1dc48e1fcf8c5adbe91cc300d06092a864886f70d01010b0500308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d301e170d3231303230393136343033315a170d3438303632373136343033315a308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d30820122300d06092a864886f70d01010105000382010f003082010a0282010100d6fc7fd2988cb586ab6c2afd5d83afb083f6d24b4bd5de85feb1132fe7b8e11ac4bcbb68435a11ef80791096b71657e1c8ba813f68744477ac9ffd4b807e2745716a669811b2c2fc3ee76282a6b9afe4edb0835e4b5bc610f43e7a05d06769454f355a6d9f6dc71ebec9339b614b20256aaf446a87f56c5820e5d97f3467966f2f235911a99600364119546402bef2c4dfe66b80b926191fd2fd67686f54a067f09f82241736d3674a7eabcca4b50fe9d99a43c6cf1c7a1701759add4065cf3e002195ee725559a4011fa492fe51f807955a533d8d4197c1b75e295769a69a7b7ab619b25516c888a680b6bc9ee56d247a1caf70471ea1a107aa401b4895dddb0203010001a3533051301d0603551d0e04160414acb2df8152a35ca5af498cb289673099b9219796301f0603551d23041830168014acb2df8152a35ca5af498cb289673099b9219796300f0603551d130101ff040530030101ff300d06092a864886f70d01010b0500038201010030cc5140993e68d50669c4081f1de0f31de52d29f4dda149cba191f6a59ebcd7e7172a51376de587c95f38e5baacb7ac4f72991bbcf40cf8fe231a0c0f188c5d264510ab69cebdcc8c7092b16473779a8c95aba5589d3de0d8437e87548ab35565aef427cc81ab2adf6dae79a2e7fa0357406b8073d47d66360162c05deabc5326f5413d295dc56f0180facbb92faccc9759381dfaba0cc7a2867ddaa9d8c21696007464386e69879dbf04a3970cea7c2c5e4d34c750bdfdf89c89333a7a3b51dbb63e8f20d8ccaed63fe4181defd236302140381e71b3b05f5082513c79bc8b775e4785bf28525b58287cd3308ba79f5e96e027d2d7bb9e59453c53a97d045c"
networkstack_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqih3clUvZEqCFjMGioUKkmeuCTm1vnygz2O8AkSWSjXk35jGEDde9rhRRkX1AS+AO4StripFNnj9aAZq+GwzDzB6QXpPHQB7qy2Dp2lWybXCzvJDxDOrLUZha98wC5nkZzFmoKMdShJSX64q2PdZV7iFk8Zyc+6knKezuKKMCKoCjkxzdQ+uB3NtFZZnBL5yT7NLtvEewO0sT8+J7RuHsxOp9Z+psPajiZzLqx+R7wDt1zVSfZ4VIDa/2m7bY8cjYZqLCsZ6cMLWULMtYvkcMzYvBbyEjVrRbbCSL8kfjQrufHDKhX+g/yl1479Fm/bqTT1uUlYFFNAVbh9x/nWKBQIDAQAB"
networkstack_cert_release="30820405308202eda0030201020214117a7469c3f9c7ff3f748cc1aa93d123c2afa8a4300d06092a864886f70d01010b0500308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d301e170d3231303230393136343033355a170d3438303632373136343033355a308191310b30090603550406130246523114301206035504080c0b496c6564654672616e6365310e300c06035504070c0550617269733110300e060355040a0c07416e64726f696431123010060355040b0c09416e64726f6e6574683112301006035504030c09416e64726f6e6574683122302006092a864886f70d0109011613636f6e7461637440736f636e6574682e636f6d30820122300d06092a864886f70d01010105000382010f003082010a0282010100aa287772552f644a821633068a850a9267ae0939b5be7ca0cf63bc0244964a35e4df98c610375ef6b8514645f5012f803b84adae2a453678fd68066af86c330f307a417a4f1d007bab2d83a76956c9b5c2cef243c433ab2d46616bdf300b99e4673166a0a31d4a12525fae2ad8f75957b88593c67273eea49ca7b3b8a28c08aa028e4c73750fae07736d15966704be724fb34bb6f11ec0ed2c4fcf89ed1b87b313a9f59fa9b0f6a3899ccbab1f91ef00edd735527d9e152036bfda6edb63c723619a8b0ac67a70c2d650b32d62f91c33362f05bc848d5ad16db0922fc91f8d0aee7c70ca857fa0ff2975e3bf459bf6ea4d3d6e52560514d0156e1f71fe758a050203010001a3533051301d0603551d0e04160414f76e8551ecda5558eaa4f3235cb2f642c03fa6e8301f0603551d23041830168014f76e8551ecda5558eaa4f3235cb2f642c03fa6e8300f0603551d130101ff040530030101ff300d06092a864886f70d01010b050003820101002fa996db476a8c3ee13658b854845970eba089e5bbe99e19496e6f26d4b0f95c9c21588f687fc015385334e4cd5fb6839ddc77d53c359b58eb4b19de79d0e3fd485986ff29082b04c6c97a2fc2af34c59c37b0a299f7f328823d077efcd09aef3458df79672b96b9ecf7a507bcf6451fdd5baa2d66989a5b9c19fbc1c6f6dc87f23f83bcaea7dc0c477806297540de35c55c765adcd2c2b017ab5dc8e60e78efc893adc47d9052ea6713cb04a5ad00d379cbf21ae7b62c63e634e42d7a9f5ec5b12f5839259b52bc571224934b0e3df53f20a99aae09b557bf1e3a199813401243075d6b6bedccb42f84c7a3d2d14f8ac4d2af5c6e860070c512323c0b7b0449"


# Test keys - "Unofficial"

media_cert_test='308204a830820390a003020102020900f2b98e6123572c4e300d06092a864886f70d0101040500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303431353233343035375a170d3335303930313233343035375a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d00308201080282010100ae250c5a16ef97fc2869ac651b3217cc36ba0e86964168d58a049f40ce85867123a3ffb4f6d949c33cf2da3a05c23eacaa57d803889b1759bcf59e7c6f21890ae25085b7ed56aa626c0989ef9ccd36362ca0e8d1b9603fd4d8328767926ccc090c68b775ae7ff30934cc369ef2855a2667df0c667fd0c7cf5d8eba655806737303bb624726eabaedfb72f07ed7a76ab3cb9a381c4b7dcd809b140d891f00213be401f58d6a06a61eadc3a9c2f1c6567285b09ae09342a66fa421eaf93adf7573a028c331d70601ab3af7cc84033ece7c772a3a5b86b0dbe9d777c3a48aa9801edcee2781589f44d9e4113979600576a99410ba81091259dad98c6c68ff784b8f020103a381fc3081f9301d0603551d0e04160414ca293caa8bc0ed3e542eef4205a2bff2b57e4d753081c90603551d230481c13081be8014ca293caa8bc0ed3e542eef4205a2bff2b57e4d75a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900f2b98e6123572c4e300c0603551d13040530030101ff300d06092a864886f70d0101040500038201010084de9516d5e4a87217a73da8487048f53373a5f733f390d61bdf3cc9e5251625bfcaa7c3159cae275d172a9ae1e876d5458127ac542f68290dd510c0029d8f51e0ee156b7b7b5acdb394241b8ec78b74e5c42c5cafae156caf5bd199a23a27524da072debbe378464a533630b0e4d0ffb7e08ecb701fadb6379c74467f6e00c6ed888595380792038756007872c8e3007af423a57a2cab3a282869b64c4b7bd5fc187d0a7e2415965d5aae4e07a6df751b4a75e9793c918a612b81cd0b628aee0168dc44e47b10d3593260849d6adf6d727dc24444c221d3f9ecc368cad07999f2b8105bc1f20d38d41066cc1411c257a96ea4349f5746565507e4e8020a1a81'
media_key_test='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAriUMWhbvl/woaaxlGzIXzDa6DoaWQWjVigSfQM6FhnEjo/+09tlJwzzy2joFwj6sqlfYA4ibF1m89Z58byGJCuJQhbftVqpibAmJ75zNNjYsoOjRuWA/1Ngyh2eSbMwJDGi3da5/8wk0zDae8oVaJmffDGZ/0MfPXY66ZVgGc3MDu2JHJuq67fty8H7Xp2qzy5o4HEt9zYCbFA2JHwAhO+QB9Y1qBqYercOpwvHGVnKFsJrgk0Kmb6Qh6vk633VzoCjDMdcGAas698yEAz7OfHcqOluGsNvp13fDpIqpgB7c7ieBWJ9E2eQROXlgBXaplBC6gQkSWdrZjGxo/3hLjwIBAw=='
platform_cert_test='308204a830820390a003020102020900b3998086d056cffa300d06092a864886f70d0101040500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303431353232343035305a170d3335303930313232343035305a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d003082010802820101009c780592ac0d5d381cdeaa65ecc8a6006e36480c6d7207b12011be50863aabe2b55d009adf7146d6f2202280c7cd4d7bdb26243b8a806c26b34b137523a49268224904dc01493e7c0acf1a05c874f69b037b60309d9074d24280e16bad2a8734361951eaf72a482d09b204b1875e12ac98c1aa773d6800b9eafde56d58bed8e8da16f9a360099c37a834a6dfedb7b6b44a049e07a269fccf2c5496f2cf36d64df90a3b8d8f34a3baab4cf53371ab27719b3ba58754ad0c53fc14e1db45d51e234fbbe93c9ba4edf9ce54261350ec535607bf69a2ff4aa07db5f7ea200d09a6c1b49e21402f89ed1190893aab5a9180f152e82f85a45753cf5fc19071c5eec827020103a381fc3081f9301d0603551d0e041604144fe4a0b3dd9cba29f71d7287c4e7c38f2086c2993081c90603551d230481c13081be80144fe4a0b3dd9cba29f71d7287c4e7c38f2086c299a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900b3998086d056cffa300c0603551d13040530030101ff300d06092a864886f70d01010405000382010100572551b8d93a1f73de0f6d469f86dad6701400293c88a0cd7cd778b73dafcc197fab76e6212e56c1c761cfc42fd733de52c50ae08814cefc0a3b5a1a4346054d829f1d82b42b2048bf88b5d14929ef85f60edd12d72d55657e22e3e85d04c831d613d19938bb8982247fa321256ba12d1d6a8f92ea1db1c373317ba0c037f0d1aff645aef224979fba6e7a14bc025c71b98138cef3ddfc059617cf24845cf7b40d6382f7275ed738495ab6e5931b9421765c491b72fb68e080dbdb58c2029d347c8b328ce43ef6a8b15533edfbe989bd6a48dd4b202eda94c6ab8dd5b8399203daae2ed446232e4fe9bd961394c6300e5138e3cfd285e6e4e483538cb8b1b357'
platform_key_test='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAnHgFkqwNXTgc3qpl7MimAG42SAxtcgexIBG+UIY6q+K1XQCa33FG1vIgIoDHzU172yYkO4qAbCazSxN1I6SSaCJJBNwBST58Cs8aBch09psDe2AwnZB00kKA4WutKoc0NhlR6vcqSC0JsgSxh14SrJjBqnc9aAC56v3lbVi+2OjaFvmjYAmcN6g0pt/tt7a0SgSeB6Jp/M8sVJbyzzbWTfkKO42PNKO6q0z1M3GrJ3GbO6WHVK0MU/wU4dtF1R4jT7vpPJuk7fnOVCYTUOxTVge/aaL/SqB9tffqIA0JpsG0niFAL4ntEZCJOqtakYDxUugvhaRXU89fwZBxxe7IJwIBAw=='
shared_cert_test='308204a830820390a003020102020900f2a73396bd38767a300d06092a864886f70d0101040500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303732333231353735395a170d3335313230393231353735395a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d00308201080282010100c8c2dbfd094a2df45c3ff1a32ed21805ec72fc58d017971bd0f6b52c262d70819d191967e158dfd3a2c7f1b3e0e80ce545d79d2848220211eb86f0fd8312d37b420c113750cc94618ae872f4886463bdc4627caa0c0483c86493e3515571170338bfdcc4cd6addd1c0a2f35f5cf24ed3e4043a3e58e2b05e664ccde12bcb67735fd6df1249c369e62542bc0a4729e53917f5c38ffa52d17b73c9c73798ddb18ed481590875547e66bfc5daca4c25a6eb960ed96923709da302ba646cb496b325e86c5c8b2e7a3377b2bbe4c7cf33254291163f689152ac088550c83c508f4bf5adf0aed5a2dca0583f9ab0ad17650db7eea4b23fdb45885547d0feab72183889020103a381fc3081f9301d0603551d0e04160414cb4c7e2cdbb3f0ada98dab79968d172e9dbb1ed13081c90603551d230481c13081be8014cb4c7e2cdbb3f0ada98dab79968d172e9dbb1ed1a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900f2a73396bd38767a300c0603551d13040530030101ff300d06092a864886f70d0101040500038201010040a8d096997959e917a36c44246b6bac2bae05437ecd89794118f7834720352d1c6f8a39b0869942f4da65981faa2951d33971129ec1921d795671c527d6e249f252829faf5b591310311e2de096500d568ad4114a656dc34a8c6f610453afc1ea7992dba4aa7b3f8543a6e35c0728de77fe97eeac83771fd0ec90f8e4449434ee0b6045783e70c7a2e460249260e003cf7608dc352a4c9ef706def4b26050e978ae2fffd7a3323787014915eb3cc874fcc7a9ae930877c5c8c7d1c2e2a8ee863c89180d1855cedba400e7ba43cccaa7243d397e7c0e8e8e4d7d4f92b6bbead49c0cf018069eddca2e7e2fb4668d89dbbd7950d0cd254180fa1eaafc2a556f84'
shared_key_test='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAyMLb/QlKLfRcP/GjLtIYBexy/FjQF5cb0Pa1LCYtcIGdGRln4Vjf06LH8bPg6AzlRdedKEgiAhHrhvD9gxLTe0IMETdQzJRhiuhy9IhkY73EYnyqDASDyGST41FVcRcDOL/cxM1q3dHAovNfXPJO0+QEOj5Y4rBeZkzN4SvLZ3Nf1t8SScNp5iVCvApHKeU5F/XDj/pS0Xtzycc3mN2xjtSBWQh1VH5mv8XaykwlpuuWDtlpI3CdowK6ZGy0lrMl6Gxciy56M3eyu+THzzMlQpEWP2iRUqwIhVDIPFCPS/Wt8K7VotygWD+asK0XZQ237qSyP9tFiFVH0P6rchg4iQIBAw=='
networkstack_key_test="MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAu3H1E3/wstdXrMLKPTeOD43hEJDVyvPUnjFNNcKDt3iwLXktjrpEA2TKlwmFRBZg8LwAr7xj3WEbG/Ua0ooe3SHgBI9Ui4D4vRE+JWgoIvV9q4Jzr68Sxk0ZoMa+I48+Zt3HmxD9kmkx4+5gp79hhkTaPCxPxCgTnUXSe+2n/kXjAHW0k+rW7AHN1V2THAplfi5ZdCymMrbcOEKi3rfSJEPICSkdelSSA65q41ZYKkyiPzDwVJxOyECKdSeOlcaeg5CtUoC876728TCaQb2fO/tdEtyn557G/WhIGT+pq3KCJIh7T5Pphex8v2QBsOhjpLkcBdBG8ED+lUAEsWRZVPy0EUzuHotktH1xmhnvTAAcsYP38+Fm5D9W1oBHw0QNo0/fUp1EJ0uLL2r7NFCRrYrUuTvVxV1SKGpdPBV0ZduN32LnzbaxD7GIiARq/dJjrm8hJdkGV1nH5C+GEKZ0btvcVH1DAWEu7sPDy9Ek3s7MjTiyDnOxPyTufKE6mMX2HwyBsH0rUZdJvCvLnglJrvbBGKPoEl5qtX/ORrsJGmZ0DhCzHHQLiRkAwOzanMaey08zaZmLF1EG3QpP/XAk6351/t0aWxMdC7K0DGNJHjz4a4lXshUhs6lu0TdqUaasaXhmsCVt7hvNmrmhiL9M7YC1ml8kwtqaVet7DlAhFuMCAwEAAQ=="
networkstack_cert_test="308205dc308203c4a003020102020900fc6cb0d8a6fdd168300d06092a864886f70d01010b0500308181310b30090603550406130255533113301106035504080c0a43616c69666f726e69613116301406035504070c0d4d6f756e7461696e20566965773110300e060355040a0c07416e64726f69643110300e060355040b0c07416e64726f69643121301f06035504030c18636f6d2e616e64726f69642e6e6574776f726b737461636b3020170d3139303231323031343632305a180f34373537303130383031343632305a308181310b30090603550406130255533113301106035504080c0a43616c69666f726e69613116301406035504070c0d4d6f756e7461696e20566965773110300e060355040a0c07416e64726f69643110300e060355040b0c07416e64726f69643121301f06035504030c18636f6d2e616e64726f69642e6e6574776f726b737461636b30820222300d06092a864886f70d01010105000382020f003082020a0282020100bb71f5137ff0b2d757acc2ca3d378e0f8de11090d5caf3d49e314d35c283b778b02d792d8eba440364ca970985441660f0bc00afbc63dd611b1bf51ad28a1edd21e0048f548b80f8bd113e25682822f57dab8273afaf12c64d19a0c6be238f3e66ddc79b10fd926931e3ee60a7bf618644da3c2c4fc428139d45d27beda7fe45e30075b493ead6ec01cdd55d931c0a657e2e59742ca632b6dc3842a2deb7d22443c809291d7a549203ae6ae356582a4ca23f30f0549c4ec8408a75278e95c69e8390ad5280bcefaef6f1309a41bd9f3bfb5d12dca7e79ec6fd6848193fa9ab728224887b4f93e985ec7cbf6401b0e863a4b91c05d046f040fe954004b1645954fcb4114cee1e8b64b47d719a19ef4c001cb183f7f3e166e43f56d68047c3440da34fdf529d44274b8b2f6afb345091ad8ad4b93bd5c55d52286a5d3c157465db8ddf62e7cdb6b10fb18888046afdd263ae6f2125d9065759c7e42f8610a6746edbdc547d4301612eeec3c3cbd124dececc8d38b20e73b13f24ee7ca13a98c5f61f0c81b07d2b519749bc2bcb9e0949aef6c118a3e8125e6ab57fce46bb091a66740e10b31c740b891900c0ecda9cc69ecb4f3369998b175106dd0a4ffd7024eb7e75fedd1a5b131d0bb2b40c63491e3cf86b8957b21521b3a96ed1376a51a6ac697866b0256dee1bcd9ab9a188bf4ced80b59a5f24c2da9a55eb7b0e502116e30203010001a3533051301d0603551d0e041604149383c92cfbf099d5c47b0c3657d8622a084b72e1301f0603551d230418301680149383c92cfbf099d5c47b0c3657d8622a084b72e1300f0603551d130101ff040530030101ff300d06092a864886f70d01010b050003820201006a0501382fde2a6b8f70c60cd1b8ee4f788718c288b170258ef3a96230b65005650d6a4c42a59a97b2ddec502413e7b438fbd060363d74b74a232382a7f77fd3da34e38f79fad035a8b472c5cff365818a0118d87fa1e31cc7ed4befd27628760c290980c3cc3b7ff0cfd01b75ff1fcc83e981b5b25a54d85b68a80424ac26015fb3a4c754969a71174c0bc283f6c88191dced609e245f5938ffd0ad799198e2d0bf6342221c1b0a5d332ed2fffc668982cabbcb7d3b630ff8476e5c84ac0ad37adf9224035200039f95ec1fa95bf83796c0e8986135cee2dcaef190b249855a7e7397d4a0bf17ea63d978589c6b48118a381fffbd790c44d80233e2e35292a3b5533ca3f2cc173f85cf904adfe2e4e2183dc1eba0ebae07b839a81ff1bc92e292550957c8599af21e9c0497b9234ce345f3f508b1cc872aa55ddb5e773c5c7dd6577b9a8b6daed20ae1ff4b8206fd9f5c8f5a22ba1980bef01ae6fcb2659b97ad5b985fa81c019ffe008ddd9c8130c06fc6032b2149c2209fc438a7e8c3b20ce03650ad31c4ee48f169777a0ae182b72ca31b81540f61f167d8d7adf4f6bb2330ff5c24037245000d8172c12ab5d5aa5890b8b12db0f0e7296264eb66e7f9714c31004649fb4b864005f9c43c80db3f6de52fd44d6e2036bfe7f5807156ed5ab591d06fd6bb93ba4334ea2739af8b41ed2686454e60b666d10738bb7ba88001"

test_cert='308204a830820390a003020102020900936eacbe07f201df300d06092a864886f70d0101050500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303232393031333334365a170d3335303731373031333334365a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d00308201080282010100d6931904dec60b24b1edc762e0d9d8253e3ecd6ceb1de2ff068ca8e8bca8cd6bd3786ea70aa76ce60ebb0f993559ffd93e77a943e7e83d4b64b8e4fea2d3e656f1e267a81bbfb230b578c20443be4c7218b846f5211586f038a14e89c2be387f8ebecf8fcac3da1ee330c9ea93d0a7c3dc4af350220d50080732e0809717ee6a053359e6a694ec2cb3f284a0a466c87a94d83b31093a67372e2f6412c06e6d42f15818dffe0381cc0cd444da6cddc3b82458194801b32564134fbfde98c9287748dbf5676a540d8154c8bbca07b9e247553311c46b9af76fdeeccc8e69e7c8a2d08e782620943f99727d3c04fe72991d99df9bae38a0b2177fa31d5b6afee91f020103a381fc3081f9301d0603551d0e04160414485900563d272c46ae118605a47419ac09ca8c113081c90603551d230481c13081be8014485900563d272c46ae118605a47419ac09ca8c11a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900936eacbe07f201df300c0603551d13040530030101ff300d06092a864886f70d010105050003820101007aaf968ceb50c441055118d0daabaf015b8a765a27a715a2c2b44f221415ffdace03095abfa42df70708726c2069e5c36eddae0400be29452c084bc27eb6a17eac9dbe182c204eb15311f455d824b656dbe4dc2240912d7586fe88951d01a8feb5ae5a4260535df83431052422468c36e22c2a5ef994d61dd7306ae4c9f6951ba3c12f1d1914ddc61f1a62da2df827f603fea5603b2c540dbd7c019c36bab29a4271c117df523cdbc5f3817a49e0efa60cbd7f74177e7a4f193d43f4220772666e4c4d83e1bd5a86087cf34f2dec21e245ca6c2bb016e683638050d2c430eea7c26a1c49d3760a58ab7f1a82cc938b4831384324bd0401fa12163a50570e684d'
test_key='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEA1pMZBN7GCySx7cdi4NnYJT4+zWzrHeL/Boyo6LyozWvTeG6nCqds5g67D5k1Wf/ZPnepQ+foPUtkuOT+otPmVvHiZ6gbv7IwtXjCBEO+THIYuEb1IRWG8DihTonCvjh/jr7Pj8rD2h7jMMnqk9Cnw9xK81AiDVAIBzLggJcX7moFM1nmppTsLLPyhKCkZsh6lNg7MQk6ZzcuL2QSwG5tQvFYGN/+A4HMDNRE2mzdw7gkWBlIAbMlZBNPv96YySh3SNv1Z2pUDYFUyLvKB7niR1UzEcRrmvdv3uzMjmnnyKLQjngmIJQ/mXJ9PAT+cpkdmd+brjigshd/ox1bav7pHwIBAw=='



PACKAGES=/data/system/packages.xml
PACKAGES_BACKUP=/data/system/packages-backup.xml

case "$1" in
    "official")
        to_official=true
        echo "Unofficial to official migration"
        ;;
    "unofficial")
        echo "Official to unofficial migration"
        ;;
    *)
        echo "USAGE: $0 official|unofficial"
        exit 1
        ;;
esac

# If there's a "backup" copy, then the current packages.xml might
# be corrupted, so overwrite it with the backup copy. This is what
# PackageManager would do.
if [ -f $PACKAGES_BACKUP ]; then
    mv $PACKAGES_BACKUP $PACKAGES
    echo "Overwriting $PACKAGES with $PACKAGES_BACKUP"
fi

if [ ! -f $PACKAGES ]; then
    echo "Error: $PACKAGES not found"
    exit 1
fi

# Save a copy of the current file, not to be confused with
# packages-backup.xml, which is used and generated by Android
echo "Saving backup as $PACKAGES.bak"
cp $PACKAGES $PACKAGES.bak

if [ "$to_official" = "true" ]; then
    sed -i "s#$media_cert_test#$media_cert_release#g" $PACKAGES
    sed -i "s#$platform_cert_test#$platform_cert_release#g" $PACKAGES
    sed -i "s#$shared_cert_test#$shared_cert_release#g" $PACKAGES
    sed -i "s#$networkstack_cert_test#$networkstack_cert_release#g" $PACKAGES
    sed -i "s#$test_cert#$release_cert#g" $PACKAGES
    sed -i "s#$media_key_test#$media_key_release#g" $PACKAGES
    sed -i "s#$platform_key_test#$platform_key_release#g" $PACKAGES
    sed -i "s#$shared_key_test#$shared_key_release#g" $PACKAGES
    sed -i "s#$networkstack_key_test#$networkstack_key_release#g" $PACKAGES
    sed -i "s#$test_key#$release_key#g" $PACKAGES
else
    sed -i "s#$media_cert_release#$media_cert_test#g" $PACKAGES
    sed -i "s#$platform_cert_release#$platform_cert_test#g" $PACKAGES
    sed -i "s#$shared_cert_release#$shared_cert_test#g" $PACKAGES
    sed -i "s#$networkstack_cert_release#$networkstack_cert_test#g" $PACKAGES
    sed -i "s#$release_cert#$test_cert#g" $PACKAGES
    sed -i "s#$media_key_release#$media_key_test#g" $PACKAGES
    sed -i "s#$platform_key_release#$platform_key_test#g" $PACKAGES
    sed -i "s#$shared_key_release#$shared_key_test#g" $PACKAGES
    sed -i "s#$networkstack_key_release#$networkstack_key_test#g" $PACKAGES
    sed -i "s#$release_key#$test_key#g" $PACKAGES
fi

chmod 660 $PACKAGES
chown system:system $PACKAGES

echo "Done"
